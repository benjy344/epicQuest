<% if rooms.any? %>
	<% count = 0 %>
 	<% rooms.each do |room| %>
		<% count = count+1 %>
		<section class="room js-room js-room-<%= count %><% if count === 1 %> active <% end %>">
			<h2><%= room.name %></h2>


			<figure class="avatar interactive" style="left:<%= rand(1..90)%>%; top: <%= rand(25..70)%>%;">
				<svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
					 viewBox="0 0 46.6 100" style="enable-background:new 0 0 46.6 100;" xml:space="preserve">
				<g id="XMLID_3_">
					<radialGradient id="XMLID_51_" cx="29.5731" cy="95.3758" r="12.0758" gradientUnits="userSpaceOnUse">
						<stop  offset="0" style="stop-color:#4D4D4D;stop-opacity:0.4"/>
						<stop  offset="1" style="stop-color:#333333;stop-opacity:0"/>
					</radialGradient>
					<ellipse id="XMLID_1_" class="avatar0" cx="29.6" cy="95.4" rx="16.4" ry="4.6"/>
					<g id="XMLID_2_">
						<path id="XMLID_5_" class="avatar1" d="M20.7,94.8l4.7,1.9c0,0,2.2,1,3.7-0.6c1.5-1.7-2.4-3.6-2.4-3.6V81.6c-2-0.2-4-0.5-6-1V94.8z"/>
						<g id="XMLID_6_">
							<path id="XMLID_8_" class="avatar1" d="M32.7,81.6v11.9l4.6,1.9c0,0,1.7,1,3.2-0.6c1.5-1.7-2.8-3.6-2.8-3.6V80.7
								C36.7,81.1,34.7,81.4,32.7,81.6z"/>
							<path id="XMLID_12_" class="avatar2" d="M37.7,77h-5v8.5c2-0.2,4-0.5,5-0.9V77z"/>
						</g>
						<path id="XMLID_11_" class="avatar2" d="M20.7,79v5.5c2,0.4,4,0.8,6,1V79H20.7z"/>
					</g>
					<path id="XMLID_4_" class="avatar1" d="M32.2,35.6c7.5-2.1,12.9-9,12.9-17.2c0-9.9-8-17.9-17.9-17.9S-3.3,8.3,0.4,41.2
						c3,4,15.1-3.8,24.7-4.8c-1.5,6-6.2,22.8-14.5,29.8C7.3,83.4,31,82.6,32.5,82.7c1.5,0,12.6-0.3,14.1-12.5
						C45.1,52.2,35.5,39.6,32.2,35.6z"/>
					<circle id="XMLID_7_" class="avatar2" cx="34.9" cy="18.6" r="2"/>
				</g>
				</svg>
				<div class="tooltip">
					<header><h3><%= @avatar.name %></h3></header>
					<section>
						<ul>
							<li class="js-sword" >Sword</li>
							<li class="js-shield" >Shield</li>
							<li class="js-armor" >Armor</li>
							<li class="js-gold" >Gold</li>
						</ul>
					</section>
				</div>
			</figure>

			<% room.monsters.each_with_index do |monster, index| %>
				<figure id="monster-<%=room.id%>-<%=monster.id%>-<%=index%>" class="js-interactive-monster monster interactive" style="left:<%= rand(1..90)%>%; top: <%= rand(25..70)%>%;">
					<div class="tooltip">
						<header><h3><%= monster.name %></h3></header>
						<section>
							<ul>
								<li>A shadow is hiding in the smoke..</li>
								<li class="js-get-fight" data-monster= '{
									"name"    : "<%= monster.name%>",
									"id"      : "<%= monster.id%>",
									"hp"      : <%= monster.hp%>,
									"hpMax"   : <%= monster.hp%>,
									"exp"     : <%= monster.exp%>,
									"force"   : <%= monster.strong%>,
									"agility" : <%= monster.agility%>,
									"defence" : <%= monster.defence%>,
									"isDead"  : false
									}'>Attack</li>
							</ul>
						</section>
					</div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
					<div class="smoke"></div>
				</figure>
			<% end %>

			<% room.chests.each do |chest| %>

				<figure class="chest interactive" style="left:<%= rand(1..90)%>%; top: <%= rand(25..70)%>%;">
					<svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
						 viewBox="0 0 100 100" style="enable-background:new 0 0 100 100;" xml:space="preserve">
					<g id="XMLID_8_">
						<polygon id="XMLID_1_" class="chest0" points="92.2,73.4 48.1,98.3 48.1,49.6 92.2,24.7 	"/>
						<polygon id="XMLID_3_" class="chest1" points="48.1,98.3 6.6,74.2 6.6,25.6 48.1,49.6 	"/>
						<polygon id="XMLID_2_" class="chest2" points="48.1,0.9 92.2,24.7 48.1,49.6 6.6,25.6 	"/>
						<g id="XMLID_5_">
							<polygon id="XMLID_4_" class="chest3" points="32.4,62.2 19.4,54.8 19.4,45.8 32.4,53.2 		"/>
							<polygon id="XMLID_6_" class="chest3" points="48.1,65.3 6.6,41.4 6.6,38.2 48.1,62 		"/>
							<polygon id="XMLID_7_" class="chest3" points="92.2,40.6 48.1,65.5 48.1,62.2 92.2,37.3 		"/>
						</g>
					</g>
					</svg>
					<div class="tooltip">
						<header><h3>Chest</h3></header>
						<section>
							<ul>
								<% if chest.items.count === 0 && chest.gold === 0%>
									<li>Empty..</li>
								<% else %>
									<% if chest.items.count > 0%>
										<% chest.items.each do |item| %>
											<% @title = 'Take '+item.name %>
											<li class="js-add-item" data-item-id="<%= item.id %>"><%= 'Take '+item.name %></li>
										<% end %>
									<% end %>
									<% if chest.gold > 0 %>
										<li class="js-add-gold" data-gold="<%= chest.gold %>"><%= 'Take '+chest.gold.to_s+ ' Gold' %></li>
									<% end %>
								<% end %>
							</ul>
						</section>
					</div>
				</figure>
			<% end %>

			<div class="stairs interactive" style="left:<%= rand(1..90)%>%; top: <%= rand(25..70)%>%;">
				<svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
					 viewBox="0 0 500 440.5" style="enable-background:new 0 0 500 440.5;" xml:space="preserve">
				<g id="XMLID_16_">
					<polygon id="XMLID_8_" class="stars0" points="212.7,440.5 501.5,280.5 501.5,120 332.5,216.4 212.7,408.5 	"/>
					<polygon id="XMLID_10_" class="stairs1" points="0,287.2 30.1,269.6 30,239.2 60.1,221.6 60,191.1 90.2,173.6 90,143.1 120.2,125.6
						119.8,95.2 332,216.4 332,248.4 302.6,264.4 304.4,296.5 273,312.4 273,343.3 241,360.5 241,392.5 211,408.5 	"/>
					<polygon id="XMLID_9_" class="stairs2" points="212.7,440.5 0,317.6 0,287.2 212.7,408.5 	"/>
					<polygon id="XMLID_11_" class="stairs2" points="242.7,392.5 30.1,269.6 30.1,239.2 242.7,360.5 	"/>
					<polygon id="XMLID_12_" class="stairs2" points="272.8,344.5 60.1,221.6 60.1,191.2 272.8,312.4 	"/>
					<polygon id="XMLID_13_" class="stairs2" points="304.3,296.5 90.2,173.6 90.2,143.2 302.8,264.4 	"/>
					<polygon id="XMLID_14_" class="stairs2" points="332.9,248.4 120.2,125.6 120.2,95.2 332.9,216.4 	"/>
					<polygon id="XMLID_15_" class="stairs1" points="501.5,120 282.8,0 120,95.2 332.5,216.4 	"/>
				</g>
				</svg>
				<div class="tooltip">
						<header><h3>Stairs</h3></header>
						<section>
							<ul>
								<li class="stairs-closed visible-stairs" >The stairs are closed .. A monster must have the key</li>
								<% if count+1 > rooms.count %>
								    <li class="finish hidden-stairs">
								    	<%= link_to 'Leave the dungeon', {controller: "avatars", action: "finishDonjon", donjon_id: @donjon.id }%>
							    	</li>
							    <% else %>
							    <li class="js-next-room hidden-stairs" data-next="<%= count+1 %>">Next room</li>
								<% end %>
								<% if count-1 > 0 %>
									<li class="js-prev-room" data-next="<%= count-1 %>">Previous room</li>
								<% else %>
									<% if current_user.avatar.countUnlockDonjon>1 %>
										<li class="finish"">
									    	<%= link_to 'Leave the dungeon', town_path %>
								    	</li>
								    <% end %>
								<% end %>
							</ul>
						</section>
					</div>
			</div>
		</section>
	<% end %>
<% end %>